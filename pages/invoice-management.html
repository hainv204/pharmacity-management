<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý hóa đơn bán hàng - Pharmacity Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/invoice.css">
    <script src="https://unpkg.com/jspdf-font/dist/font/ArialUnicode.js"></script>
</head>

<body>
    <div id="header"></div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block sidebar-wrapper collapse" id="sidebar"></div>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                <!-- 1. Top Bar - Thanh công cụ chính -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1 class="page-title">Quản lý hóa đơn bán hàng</h1>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal"
                            data-bs-target="#filterModal">
                            <i class="fas fa-filter me-1"></i> Lọc nâng cao
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                            data-bs-target="#createInvoiceModal">
                            <i class="fas fa-plus me-1"></i> Lập hóa đơn
                        </button>
                    </div>
                </div>

                <!-- Thanh công cụ tìm kiếm và lọc - Cập nhật để khớp với kịch bản -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form class="row g-3" id="searchForm">
                            <div class="col-md-4">
                                <div class="search-box">
                                    <input type="text" class="form-control" id="invoiceSearch"
                                        placeholder="Tìm kiếm theo mã hoá đơn...">
                                    <i class="fas fa-search search-icon"></i>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0">
                                        <i class="fas fa-calendar-alt text-muted"></i>
                                    </span>
                                    <input type="text" class="form-control border-start-0" id="dateFilter"
                                        placeholder="01/05/2025 đến 02/06/2025">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <select class="form-select" id="statusFilter">
                                    <option value="all">Tất cả trạng thái</option>
                                    <option value="paid">Đã thanh toán</option>
                                    <option value="processing">Đang xử lý</option>
                                    <option value="cancelled">Đã huỷ</option>
                                </select>
                            </div>
                            <div class="col-md-2 d-flex gap-2">
                                <button type="submit" class="btn btn-primary flex-grow-1">
                                    <i class="fas fa-filter me-1"></i> Lọc
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- 2. Main Content - Danh sách hoá đơn -->
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table align-middle" id="invoiceTable">
                                <thead>
                                    <tr>
                                        <th scope="col">Mã hóa đơn</th>
                                        <th scope="col">Ngày lập</th>
                                        <th scope="col">Khách hàng</th>
                                        <th scope="col">Tổng tiền</th>
                                        <th scope="col">Ưu đãi áp dụng</th>
                                        <th scope="col">Trạng thái</th>
                                        <th scope="col">Hành động</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="fw-medium">HD001</td>
                                        <td>20/05/2025 14:30</td>
                                        <td>Nguyễn Văn A</td>
                                        <td class="fw-medium">250.000 đ</td>
                                        <td>Không có</td>
                                        <td><span class="text-success">Đã thanh toán</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="btn-action view" data-bs-toggle="tooltip"
                                                    title="Xem chi tiết">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn-action trash-can" data-bs-toggle="tooltip"
                                                    title="Xoá đơn" disabled>
                                                    <i class="fas fa-trash-alt"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="fw-medium">HD002</td>
                                        <td>19/05/2025 10:15</td>
                                        <td>Trần Thị B</td>
                                        <td>
                                            <div class="d-flex flex-column">
                                                <span class="fw-medium">450.000 đ</span>
                                                <small class="text-decoration-line-through text-danger">500.000
                                                    đ</small>
                                            </div>
                                        </td>
                                        <td>Giảm 10%</td>
                                        <td>
                                            <span class="text-warning">Đang xử lý</span>
                                        </td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="btn-action view" data-bs-toggle="tooltip"
                                                    title="Xem chi tiết">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn-action edit" data-bs-toggle="tooltip"
                                                    title="Chỉnh sửa">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="fw-medium">HD003</td>
                                        <td>18/05/2025 16:45</td>
                                        <td>Lê Văn C</td>
                                        <td class="fw-medium">180.000 đ</td>
                                        <td>Không có</td>
                                        <td><span class="text-danger">Đã huỷ</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="btn-action view" data-bs-toggle="tooltip"
                                                    title="Xem chi tiết">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn-action cancel" data-bs-toggle="tooltip"
                                                    title="Xoá đơn">
                                                    <i class="fas fa-trash-alt"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="fw-medium">HD001</td>
                                        <td>20/05/2025 14:30</td>
                                        <td>Nguyễn Văn A</td>
                                        <td class="fw-medium">250.000 đ</td>
                                        <td>Không có</td>
                                        <td><span class="text-success">Đã thanh toán</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="btn-action view" data-bs-toggle="tooltip"
                                                    title="Xem chi tiết">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn-action trash-can" data-bs-toggle="tooltip"
                                                    title="Xoá đơn" disabled>
                                                    <i class="fas fa-trash-alt"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="fw-medium">HD001</td>
                                        <td>20/05/2025 14:30</td>
                                        <td>Nguyễn Văn A</td>
                                        <td class="fw-medium">250.000 đ</td>
                                        <td>Không có</td>
                                        <td><span class="text-success">Đã thanh toán</span></td>
                                        <td>
                                            <div class="table-actions">
                                                <button class="btn-action view" data-bs-toggle="tooltip"
                                                    title="Xem chi tiết">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn-action trash-can" data-bs-toggle="tooltip"
                                                    title="Xoá đơn" disabled>
                                                    <i class="fas fa-trash-alt"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <div class="text-muted small">
                                Hiển thị 1-3 của 25 hóa đơn
                            </div>
                            <nav aria-label="Page navigation">
                                <ul class="pagination">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 3. Modal Lập Hóa Đơn -->
    <div class="modal fade" id="createInvoiceModal" tabindex="-1" aria-labelledby="createInvoiceModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createInvoiceModalLabel">
                        <i class="fas fa-file-invoice me-2"></i> Lập hóa đơn mới
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createInvoiceForm">
                        <!-- 1. Thông tin khách hàng -->
                        <div class="card mb-3">
                            <div class="card-header bg-light py-2">
                                <h6 class="mb-0">1. Thông tin khách hàng</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Tên khách hàng</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="customerName"
                                                list="customerList" placeholder="Nhập tên khách hàng...">
                                            <button class="btn btn-outline-secondary" type="button">
                                                <i class="fas fa-search"></i>
                                            </button>
                                        </div>
                                        <datalist id="customerList">
                                            <option value="Nguyễn Văn A">
                                            <option value="Trần Thị B">
                                            <option value="Lê Văn C">
                                        </datalist>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Số điện thoại</label>
                                        <input type="tel" class="form-control" id="customerPhone">
                                    </div>

                                    <div class="col-12">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="newCustomer">
                                            <label class="form-check-label" for="newCustomer">
                                                Khách hàng mới
                                            </label>
                                        </div>
                                    </div>

                                    <div id="newCustomerInfo" class="col-12 d-none">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Giới tính</label>
                                                <select class="form-select" id="customerGender">
                                                    <option value="">-- Chọn --</option>
                                                    <option value="male">Nam</option>
                                                    <option value="female">Nữ</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Email</label>
                                                <input type="email" class="form-control" id="customerEmail"
                                                    placeholder="Email (không bắt buộc)">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body p-2">
                                                <div class="d-flex justify-content-between">
                                                    <span>Điểm tích lũy:</span>
                                                    <span class="fw-bold text-primary">125 điểm</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-body p-2">
                                                <div class="d-flex justify-content-between">
                                                    <span>Ưu đãi khả dụng:</span>
                                                    <span class="fw-bold text-success">2 ưu đãi</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 2. Danh sách thuốc -->
                        <div class="card mb-3">
                            <div class="card-header bg-light py-2">
                                <h6 class="mb-0">2. Danh sách thuốc</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="medicineSearch"
                                            placeholder="Nhập tên hoặc mã thuốc...">
                                        <button class="btn btn-primary" type="button" id="addMedicineBtn">
                                            <i class="fas fa-plus me-1"></i> Thêm thuốc
                                        </button>
                                    </div>
                                </div>

                                <div class="table-responsive">
                                    <table class="table border">
                                        <thead>
                                            <tr>
                                                <th>Mã thuốc</th>
                                                <th>Tên thuốc</th>
                                                <th>Đơn giá</th>
                                                <th>Số lượng</th>
                                                <th>Thành tiền</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody id="medicineList">
                                            <tr>
                                                <td>MED001</td>
                                                <td>Paracetamol 500mg</td>
                                                <td>2.000đ</td>
                                                <td>
                                                    <input type="number"
                                                        class="form-control form-control-sm quantity-input" value="5"
                                                        min="1" style="width: 70px">
                                                </td>
                                                <td>10.000đ</td>
                                                <td>
                                                    <button type="button" class="btn btn-sm btn-danger">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>MED015</td>
                                                <td>Vitamin C 500mg</td>
                                                <td>15.000đ</td>
                                                <td>
                                                    <input type="number"
                                                        class="form-control form-control-sm quantity-input" value="2"
                                                        min="1" style="width: 70px">
                                                </td>
                                                <td>30.000đ</td>
                                                <td>
                                                    <button type="button" class="btn btn-sm btn-danger">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <td colspan="4" class="text-end">Tổng phụ:</td>
                                                <td colspan="2" class="fw-bold">40.000đ</td>
                                            </tr>
                                            <tr id="discountRow">
                                                <td colspan="4" class="text-end">Giảm giá:</td>
                                                <td colspan="2" class="fw-bold text-success">-4.000đ (10%)</td>
                                            </tr>
                                            <tr>
                                                <td colspan="4" class="text-end">Tổng thanh toán:</td>
                                                <td colspan="2" class="fw-bold fs-5 text-primary">36.000đ</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 3. Thông tin khác -->
                        <div class="card mb-3">
                            <div class="card-header bg-light py-2">
                                <h6 class="mb-0">3. Thông tin khác</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Ngày lập</label>
                                        <input type="text" class="form-control datepicker" id="invoiceDate"
                                            value="02/06/2025">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Hình thức thanh toán</label>
                                        <div class="input-group">
                                            <span class="input-group-text bg-light">
                                                <i id="paymentMethodIcon"
                                                    class="fas fa-money-bill-wave text-success"></i>
                                            </span>
                                            <select class="form-select" id="paymentMethodSelect">
                                                <option value="cash" selected data-icon="fa-money-bill-wave"
                                                    data-color="text-success">Tiền mặt</option>
                                                <option value="card" data-icon="fa-credit-card"
                                                    data-color="text-primary">Thẻ ngân hàng</option>
                                                <option value="transfer" data-icon="fa-university"
                                                    data-color="text-info">Chuyển khoản</option>
                                                <option value="momo" data-icon="fa-mobile-alt" data-color="text-danger">
                                                    Ví MoMo</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Ưu đãi áp dụng</label>
                                        <select class="form-select" id="discountSelect">
                                            <option value="">Không áp dụng</option>
                                            <option value="percent10" selected>Giảm 10% tổng hóa đơn</option>
                                            <option value="amount20k">Giảm 20.000đ</option>
                                            <option value="freeship">Miễn phí giao hàng</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="d-flex align-items-center h-100" style="padding-top: 2rem;">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="autoDiscount"
                                                    checked>
                                                <label class="form-check-label" for="autoDiscount">
                                                    Áp dụng ưu đãi tốt nhất tự động
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Ghi chú</label>
                                        <textarea class="form-control" id="invoiceNotes" rows="2"
                                            placeholder="Thêm ghi chú về đơn hàng..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary me-2" id="saveInvoiceBtn">
                        <i class="fas fa-save me-1"></i> Lưu hóa đơn
                    </button>
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Hủy hoá đơn</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. Modal Chi tiết hóa đơn -->
    <div class="modal fade" id="invoiceDetailModal" tabindex="-1" aria-labelledby="invoiceDetailModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="invoiceDetailModalLabel">Chi tiết hóa đơn #HD001</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Thông tin hóa đơn -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-1"><strong>Mã hóa đơn:</strong> #HD001</p>
                                    <p class="mb-1"><strong>Khách hàng:</strong> Nguyễn Văn A</p>
                                    <p class="mb-1"><strong>Số điện thoại:</strong> 0123456789</p>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <p class="mb-1"><strong>Ngày lập:</strong> 20/05/2025 14:30</p>
                                    <p class="mb-1"><strong>Trạng thái:</strong> <span
                                            class="status-badge status-paid"><i class="fas fa-check-circle"></i> Đã
                                            thanh toán</span></p>
                                    <p class="mb-1"><strong>Hình thức:</strong> Tiền mặt</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs mb-3" id="invoiceDetailTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="details-tab" data-bs-toggle="tab"
                                data-bs-target="#details" type="button" role="tab" aria-controls="details"
                                aria-selected="true">Chi tiết hóa đơn</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history"
                                type="button" role="tab" aria-controls="history" aria-selected="false">Lịch sử giao
                                dịch</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="invoiceDetailTabsContent">
                        <div class="tab-pane fade show active" id="details" role="tabpanel"
                            aria-labelledby="details-tab">
                            <!-- Nội dung chi tiết hóa đơn hiện tại -->
                            <!-- Chi tiết sản phẩm -->
                            <h6 class="fw-bold mb-3">Danh sách thuốc</h6>
                            <div class="table-responsive mb-3">
                                <table class="table border">
                                    <thead>
                                        <tr>
                                            <th>Mã thuốc</th>
                                            <th>Tên thuốc</th>
                                            <th class="text-end">Đơn giá</th>
                                            <th class="text-center">Số lượng</th>
                                            <th class="text-end">Thành tiền</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>MED001</td>
                                            <td>Paracetamol 500mg</td>
                                            <td class="text-end">2.000 đ</td>
                                            <td class="text-center">50</td>
                                            <td class="text-end">100.000 đ</td>
                                        </tr>
                                        <tr>
                                            <td>MED010</td>
                                            <td>Amoxicillin 500mg</td>
                                            <td class="text-end">3.000 đ</td>
                                            <td class="text-center">30</td>
                                            <td class="text-end">90.000 đ</td>
                                        </tr>
                                        <tr>
                                            <td>MED022</td>
                                            <td>Vitamin C 1000mg</td>
                                            <td class="text-end">15.000 đ</td>
                                            <td class="text-center">4</td>
                                            <td class="text-end">60.000 đ</td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="4" class="text-end fw-bold">Tổng phụ:</td>
                                            <td class="text-end fw-bold">250.000 đ</td>
                                        </tr>
                                        <tr>
                                            <td colspan="4" class="text-end fw-bold">Giảm giá:</td>
                                            <td class="text-end fw-bold">0 đ</td>
                                        </tr>
                                        <tr>
                                            <td colspan="4" class="text-end fw-bold">Tổng thanh toán:</td>
                                            <td class="text-end fw-bold fs-5 text-primary">250.000 đ</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <!-- Ghi chú -->
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-2">Ghi chú:</h6>
                                    <p class="mb-0 text-muted">Khách hàng cần đơn thuốc gấp. Đã tư vấn cách sử dụng
                                        Amoxicillin.</p>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="fw-bold mb-0">Lịch sử giao dịch của khách hàng</h6>
                                <!-- Bộ lọc lịch sử giao dịch -->
                                <div class="d-flex gap-2">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text bg-white border-end-0">
                                            <i class="fas fa-calendar-alt text-muted"></i>
                                        </span>
                                        <input type="text" class="form-control border-start-0 datepicker-range"
                                            id="historyDateFilter" placeholder="Từ ngày - Đến ngày">
                                    </div>
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text bg-white border-end-0">
                                            <i class="fas fa-pills text-muted"></i>
                                        </span>
                                        <input type="text" class="form-control border-start-0" id="historyProductFilter"
                                            placeholder="Tìm theo thuốc">
                                    </div>
                                    <button class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-filter me-1"></i> Lọc
                                    </button>
                                </div>
                            </div>

                            <!-- Lịch sử giao dịch -->
                            <div class="table-responsive">
                                <table class="table border">
                                    <thead>
                                        <tr>
                                            <th>Mã hóa đơn</th>
                                            <th>Ngày giao dịch</th>
                                            <th>Sản phẩm</th>
                                            <th>Tổng tiền</th>
                                            <th>Trạng thái</th>
                                            <th>Hành động</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="fw-medium">HD001</td>
                                            <td>20/05/2025 14:30</td>
                                            <td>
                                                <span class="d-block">Paracetamol 500mg (x50)</span>
                                                <span class="text-muted small">Amoxicillin 500mg (x30), Vitamin C
                                                    (x4)</span>
                                            </td>
                                            <td class="fw-medium">250.000 đ</td>
                                            <td><span class="text-success">Đã thanh toán</span></td>
                                            <td>
                                                <button class="btn-action view" onclick="viewInvoiceDetails('HD001')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="fw-medium">HD123</td>
                                            <td>15/05/2025 10:15</td>
                                            <td>
                                                <span class="d-block">Vitamin B Complex (x2)</span>
                                                <span class="text-muted small">Panadol Extra (x10)</span>
                                            </td>
                                            <td class="fw-medium">180.000 đ</td>
                                            <td><span class="text-success">Đã thanh toán</span></td>
                                            <td>
                                                <button class="btn-action view" onclick="viewInvoiceDetails('HD123')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="fw-medium">HD098</td>
                                            <td>10/05/2025 17:45</td>
                                            <td>
                                                <span class="d-block">Efferalgan 500mg (x20)</span>
                                            </td>
                                            <td class="fw-medium">120.000 đ</td>
                                            <td><span class="text-success">Đã thanh toán</span></td>
                                            <td>
                                                <button class="btn-action view" onclick="viewInvoiceDetails('HD098')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Phân trang và tổng kết -->
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div class="text-muted small">
                                    Tổng cộng: <span class="fw-medium">3</span> giao dịch
                                </div>
                                <div class="d-flex flex-column align-items-end">
                                    <span class="fw-bold mb-1">Tổng chi tiêu: <span class="text-primary">550.000
                                            đ</span></span>
                                    <span class="small text-muted">Điểm tích luỹ: <span class="text-success">+55</span>
                                        điểm</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary">
                        <i class="fas fa-print me-1"></i> In hóa đơn
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal lọc nâng cao -->
    <div class="modal fade" id="filterModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-filter me-2"></i> Lọc nâng cao
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="advancedFilterForm">
                        <div class="mb-3">
                            <label class="form-label">Khoảng thời gian</label>
                            <div class="input-group">
                                <span class="input-group-text">Từ</span>
                                <input type="date" class="form-control" id="startDate">
                                <span class="input-group-text">đến</span>
                                <input type="date" class="form-control" id="endDate">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Khách hàng</label>
                            <select class="form-select" id="customerFilter">
                                <option value="">Tất cả khách hàng</option>
                                <option value="1">Nguyễn Văn A</option>
                                <option value="2">Trần Thị B</option>
                                <option value="3">Lê Văn C</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Trạng thái</label>
                            <div class="d-flex flex-wrap gap-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="statusPaid" checked>
                                    <label class="form-check-label" for="statusPaid">
                                        Đã thanh toán
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="statusProcessing" checked>
                                    <label class="form-check-label" for="statusProcessing">
                                        Đang xử lý
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="statusCancelled" checked>
                                    <label class="form-check-label" for="statusCancelled">
                                        Đã huỷ
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Tổng tiền</label>
                            <div class="row g-2">
                                <div class="col">
                                    <div class="input-group">
                                        <span class="input-group-text">Từ</span>
                                        <input type="number" class="form-control" id="minAmount" placeholder="0">
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="input-group">
                                        <span class="input-group-text">đến</span>
                                        <input type="number" class="form-control" id="maxAmount"
                                            placeholder="1.000.000">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Hình thức thanh toán</label>
                            <select class="form-select" id="paymentFilter">
                                <option value="">Tất cả hình thức</option>
                                <option value="cash">Tiền mặt</option>
                                <option value="card">Thẻ ngân hàng</option>
                                <option value="transfer">Chuyển khoản</option>
                                <option value="momo">Ví điện tử (MoMo)</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-secondary" id="resetFilter">
                        <i class="fas fa-sync-alt me-1"></i> Đặt lại
                    </button>
                    <button type="button" class="btn btn-primary" id="applyFilter">
                        <i class="fas fa-filter me-1"></i> Áp dụng
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notifications container -->
    <div class="toast-container">
        <div class="toast align-items-center border-0" id="successToast" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-check-circle text-success me-2"></i>
                    Thao tác thành công!
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <div id="footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/vn.js"></script>
    <script src="/utils/auth.js"></script>

    <!-- Modal Thanh Toán Cải Tiến -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">
                        <i class="fas fa-credit-card me-2"></i> Thanh toán đơn hàng
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Thông tin đơn hàng -->
                    <div class="card mb-4 bg-light">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="mb-1"><strong>Mã hóa đơn:</strong> <span
                                            id="paymentInvoiceId">#HD005</span>
                                    </p>
                                    <p class="mb-1"><strong>Phương thức:</strong> Thẻ ngân hàng</p>
                                </div>
                                <div class="text-end">
                                    <p class="mb-1">Tổng thanh toán:</p>
                                    <h3 class="text-primary mb-0" id="paymentTotalAmount">250.000 đ</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Thông tin thẻ -->
                    <form id="paymentForm">
                        <h6 class="mb-3 fw-bold">Thông tin thẻ thanh toán</h6>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="bankName" class="form-label">Ngân hàng</label>
                                <select class="form-select" id="bankName" required>
                                    <option value="">-- Chọn ngân hàng --</option>
                                    <option value="mbbank">MB Bank</option>
                                    <option value="vietcombank">Vietcombank</option>
                                    <option value="techcombank">Techcombank</option>
                                    <option value="vpbank">VPBank</option>
                                    <option value="other">Ngân hàng khác</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="cardType" class="form-label">Loại thẻ</label>
                                <select class="form-select" id="cardType" required>
                                    <option value="">-- Chọn loại thẻ --</option>
                                    <option value="visa">Visa</option>
                                    <option value="mastercard">Mastercard</option>
                                    <option value="jcb">JCB</option>
                                    <option value="amex">American Express</option>
                                    <option value="domestic">Thẻ nội địa</option>
                                </select>
                            </div>

                            <div class="col-md-8">
                                <label for="cardNumber" class="form-label">Số thẻ</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="cardNumber"
                                        placeholder="1234 5678 9876 5432" required maxlength="19">
                                    <span class="input-group-text">
                                        <i class="fas fa-credit-card"></i>
                                    </span>
                                </div>
                                <div class="form-text">Nhập đầy đủ số thẻ không có khoảng trắng</div>
                            </div>

                            <div class="col-md-4">
                                <label for="cvv" class="form-label">Mã CVV/CVC</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="cvv" placeholder="***" required
                                        maxlength="4">
                                    <span class="input-group-text" data-bs-toggle="tooltip"
                                        title="Mã bảo mật 3-4 số ở mặt sau thẻ">
                                        <i class="fas fa-question-circle"></i>
                                    </span>
                                </div>
                            </div>

                            <div class="col-md-8">
                                <label for="cardHolderName" class="form-label">Tên chủ thẻ</label>
                                <input type="text" class="form-control" id="cardHolderName" placeholder="NGUYEN VAN A"
                                    required>
                                <div class="form-text">Nhập chính xác tên in trên thẻ</div>
                            </div>

                            <div class="col-md-4">
                                <label for="expiryDate" class="form-label">Ngày hết hạn</label>
                                <input type="month" class="form-control" id="expiryDate" required>
                            </div>

                            <div class="col-md-6">
                                <label for="phoneNumber" class="form-label">Số điện thoại</label>
                                <input type="tel" class="form-control" id="phoneNumber" placeholder="0123456789"
                                    required>
                            </div>
                        </div>

                        <div class="mt-4 mb-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="saveCardInfo">
                                <label class="form-check-label" for="saveCardInfo">
                                    Lưu thông tin thẻ cho lần thanh toán sau
                                </label>
                            </div>
                        </div>

                        <div class="alert alert-info mt-3">
                            <div class="d-flex">
                                <div class="me-3">
                                    <i class="fas fa-shield-alt fs-3"></i>
                                </div>
                                <div>
                                    <h6 class="alert-heading mb-1">Bảo mật thanh toán</h6>
                                    <p class="mb-0 small">Thông tin thẻ của bạn được mã hóa an toàn. Chúng tôi không lưu
                                        trữ thông tin thẻ nếu bạn không đồng ý.</p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">

                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Quay lại</button>
                    <button type="button" class="btn btn-primary" id="confirmPaymentBtn">
                        <i class="fas fa-check-circle me-1"></i> Xác nhận thanh toán
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Thanh Toán Tiền Mặt -->
    <div class="modal fade" id="cashPaymentModal" tabindex="-1" aria-labelledby="cashPaymentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cashPaymentModalLabel">
                        <i class="fas fa-money-bill-wave me-2 text-success"></i> Thanh toán tiền mặt
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Thông tin đơn hàng -->
                    <div class="card mb-4 bg-light">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="mb-1"><strong>Mã hóa đơn:</strong> <span
                                            id="cashPaymentInvoiceId">#HD005</span></p>
                                    <p class="mb-1"><strong>Phương thức:</strong> Tiền mặt</p>
                                </div>
                                <div class="text-end">
                                    <p class="mb-1">Tổng thanh toán:</p>
                                    <h3 class="text-success mb-0" id="cashPaymentTotalAmount">250.000 đ</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form thanh toán tiền mặt -->
                    <form id="cashPaymentForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="cashReceived" class="form-label">Tiền khách đưa</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="cashReceived" placeholder="0" required>
                                    <span class="input-group-text">đ</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="cashChange" class="form-label">Tiền trả lại</label>
                                <div class="input-group">
                                    <input type="text" class="form-control bg-light" id="cashChange" placeholder="0"
                                        readonly>
                                    <span class="input-group-text">đ</span>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="printReceipt" checked>
                                    <label class="form-check-label" for="printReceipt">
                                        In hóa đơn sau khi thanh toán
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Quay lại</button>
                    <button type="button" class="btn btn-success" id="confirmCashPaymentBtn">
                        <i class="fas fa-check-circle me-1"></i> Xác nhận thanh toán
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Thanh Toán Chuyển Khoản -->
    <div class="modal fade" id="transferPaymentModal" tabindex="-1" aria-labelledby="transferPaymentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="transferPaymentModalLabel">
                        <i class="fas fa-university me-2 text-info"></i> Thanh toán chuyển khoản
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Thông tin đơn hàng -->
                    <div class="card mb-4 bg-light">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="mb-1"><strong>Mã hóa đơn:</strong> <span
                                            id="transferPaymentInvoiceId">#HD005</span></p>
                                    <p class="mb-1"><strong>Phương thức:</strong> Chuyển khoản</p>
                                </div>
                                <div class="text-end">
                                    <p class="mb-1">Tổng thanh toán:</p>
                                    <h3 class="text-info mb-0" id="transferPaymentTotalAmount">250.000 đ</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Thông tin tài khoản -->
                    <div class="card border-info mb-4">
                        <div class="card-header bg-info bg-opacity-10">
                            <h6 class="mb-0 text-info">Thông tin tài khoản nhận tiền</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-1"><strong>Ngân hàng:</strong> MB Bank</p>
                                    <p class="mb-1"><strong>Số tài khoản:</strong> 1234567890</p>
                                    <p class="mb-1"><strong>Chủ tài khoản:</strong> CÔNG TY CP PHARMACITY</p>
                                </div>
                                <div class="col-md-6">
                                    <div class="text-center">
                                        <img src="/assets/images/bank-qr-code.jpg" alt="QR Code"
                                            class="img-fluid border" style="max-width: 120px">
                                        <p class="mt-2 mb-0 small">Quét mã QR để chuyển khoản</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form xác nhận chuyển khoản -->
                    <form id="transferPaymentForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="transferReference" class="form-label">Mã giao dịch</label>
                                <input type="text" class="form-control" id="transferReference"
                                    placeholder="Nhập mã giao dịch">
                                <div class="form-text">Nếu có mã giao dịch, vui lòng nhập</div>
                            </div>
                            <div class="col-md-6">
                                <label for="transferTime" class="form-label">Thời gian chuyển khoản</label>
                                <input type="datetime-local" class="form-control" id="transferTime">
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="transferCompleted">
                                    <label class="form-check-label" for="transferCompleted">
                                        Tôi đã hoàn tất chuyển khoản
                                    </label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Quay lại</button>
                    <button type="button" class="btn btn-info text-white" id="confirmTransferPaymentBtn">
                        <i class="fas fa-check-circle me-1"></i> Xác nhận thanh toán
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Thanh Toán Ví MoMo -->
    <div class="modal fade" id="momoPaymentModal" tabindex="-1" aria-labelledby="momoPaymentModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="momoPaymentModalLabel">
                        <i class="fas fa-mobile-alt me-2 text-danger"></i> Thanh toán qua ví MoMo
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Thông tin đơn hàng -->
                    <div class="card mb-4 bg-light">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="mb-1"><strong>Mã hóa đơn:</strong> <span
                                            id="momoPaymentInvoiceId">#HD005</span></p>
                                    <p class="mb-1"><strong>Phương thức:</strong> Ví MoMo</p>
                                </div>
                                <div class="text-end">
                                    <p class="mb-1">Tổng thanh toán:</p>
                                    <h3 class="text-danger mb-0" id="momoPaymentTotalAmount">250.000 đ</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-center mb-4">
                        <img src="/assets/images/momo-qr-code.jpg" alt="MoMo QR Code" style="max-width: 200px;"
                            class="img-fluid border p-2">
                        <p class="mt-3 mb-0">Quét mã QR bằng ứng dụng MoMo để thanh toán</p>
                    </div>

                    <div class="alert alert-danger">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="fas fa-info-circle fs-4"></i>
                            </div>
                            <div>
                                <h6 class="alert-heading mb-1">Hướng dẫn thanh toán</h6>
                                <ol class="mb-0 ps-3">
                                    <li>Mở ứng dụng MoMo trên điện thoại</li>
                                    <li>Chọn "Quét mã" và quét mã QR phía trên</li>
                                    <li>Kiểm tra thông tin và xác nhận thanh toán</li>
                                    <li>Nhấn "Xác nhận thanh toán" ở dưới sau khi hoàn tất</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <form id="momoPaymentForm">
                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" id="momoCompleted">
                            <label class="form-check-label" for="momoCompleted">
                                Tôi đã hoàn tất thanh toán qua MoMo
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Quay lại</button>
                    <button type="button" class="btn btn-danger" id="confirmMomoPaymentBtn">
                        <i class="fas fa-check-circle me-1"></i> Xác nhận thanh toán
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal Chỉnh sửa chi tiết hoá đơn -->
    <div class="modal fade" id="editInvoiceModal" tabindex="-1" aria-labelledby="editInvoiceModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editInvoiceModalLabel">
                        <i class="fas fa-edit me-2"></i> Chỉnh sửa hoá đơn #HD002
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Thông tin cơ bản của hoá đơn -->
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-1"><strong>Mã hóa đơn:</strong> #HD002</p>
                                    <p class="mb-1"><strong>Khách hàng:</strong> Trần Thị B</p>
                                    <p class="mb-1"><strong>Số điện thoại:</strong> 0987654321</p>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <p class="mb-1"><strong>Ngày lập:</strong> 19/05/2025 10:15</p>
                                    <p class="mb-1"><strong>Trạng thái:</strong> <span class="text-warning">
                                            <i class="fas fa-clock me-1"></i>Đang xử lý</span></p>
                                    <p class="mb-1"><strong>Hình thức:</strong> Chuyển khoản</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Danh sách thuốc - Điều chỉnh để giống modal lập hoá đơn -->
                    <div class="card mb-3">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0">Danh sách thuốc</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="editMedicineSearch"
                                        placeholder="Nhập tên hoặc mã thuốc...">
                                    <button class="btn btn-primary" type="button" id="editAddMedicineBtn">
                                        <i class="fas fa-plus me-1"></i> Thêm thuốc
                                    </button>
                                </div>
                            </div>

                            <div class="table-responsive">
                                <table class="table border">
                                    <thead>
                                        <tr>
                                            <th>Mã thuốc</th>
                                            <th>Tên thuốc</th>
                                            <th>Đơn giá</th>
                                            <th>Số lượng</th>
                                            <th>Thành tiền</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="editInvoiceItems">
                                        <tr id="medicine-MED003">
                                            <td>MED003</td>
                                            <td>Vitamin C 1000mg</td>
                                            <td>50.000 đ</td>
                                            <td>
                                                <input type="number"
                                                    class="form-control form-control-sm edit-quantity-input" value="5"
                                                    min="1" style="width: 70px">
                                            </td>
                                            <td>250.000 đ</td>
                                            <td>
                                                <button type="button"
                                                    class="btn btn-sm btn-danger edit-remove-medicine">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr id="medicine-MED008">
                                            <td>MED008</td>
                                            <td>Panadol Extra</td>
                                            <td>40.000 đ</td>
                                            <td>
                                                <input type="number"
                                                    class="form-control form-control-sm edit-quantity-input" value="5"
                                                    min="1" style="width: 70px">
                                            </td>
                                            <td>200.000 đ</td>
                                            <td>
                                                <button type="button"
                                                    class="btn btn-sm btn-danger edit-remove-medicine">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="4" class="text-end">Tổng phụ:</td>
                                            <td colspan="2" class="fw-bold">450.000đ</td>
                                        </tr>
                                        <tr id="discountRow">
                                            <td colspan="4" class="text-end">Giảm giá:</td>
                                            <td colspan="2" class="fw-bold text-success">-45.000đ (10%)</td>
                                        </tr>
                                        <tr>
                                            <td colspan="4" class="text-end">Tổng thanh toán:</td>
                                            <td colspan="2" class="fw-bold fs-5 text-primary">405.000đ</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Thông tin khác - Điều chỉnh để giống modal lập hoá đơn -->
                    <div class="card mb-0">
                        <div class="card-header bg-light py-2">
                            <h6 class="mb-0">Thông tin khác</h6>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Ưu đãi áp dụng</label>
                                    <select class="form-select" id="editDiscountSelect">
                                        <option value="">Không áp dụng</option>
                                        <option value="percent10" selected>Giảm 10% tổng hóa đơn</option>
                                        <option value="amount20k">Giảm 20.000đ</option>
                                        <option value="freeship">Miễn phí giao hàng</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-center h-100" style="padding-top: 2rem;">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="autoDiscountEdit"
                                                checked>
                                            <label class="form-check-label" for="autoDiscountEdit">
                                                Áp dụng ưu đãi tốt nhất tự động
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Ghi chú</label>
                                    <textarea class="form-control" id="invoiceNotesEdit" rows="2"
                                        placeholder="Thêm ghi chú về đơn hàng...">Khách hàng yêu cầu giao hàng tận nhà. Gọi trước khi giao.</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Huỷ</button>
                    <button type="button" class="btn btn-primary" id="proceedToPaymentBtn">
                        <i class="fas fa-money-bill-wave me-1"></i> Thanh toán
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal thêm thuốc vào hoá đơn đang chỉnh sửa -->
    <div class="modal fade" id="addMedicineModal" tabindex="-1" aria-labelledby="addMedicineModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addMedicineModalLabel">
                        <i class="fas fa-pills me-2"></i> Thêm thuốc vào hoá đơn
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Tìm kiếm thuốc</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="medicineSearchInput"
                                placeholder="Nhập tên hoặc mã thuốc...">
                            <button class="btn btn-outline-secondary" type="button" id="searchMedicineBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Kết quả tìm kiếm</label>
                        <div class="table-responsive" style="max-height: 250px; overflow-y: auto;">
                            <table class="table table-hover border">
                                <thead class="sticky-top bg-white">
                                    <tr>
                                        <th>Mã thuốc</th>
                                        <th>Tên thuốc</th>
                                        <th>Đơn giá</th>
                                        <th>Chọn</th>
                                    </tr>
                                </thead>
                                <tbody id="medicineSearchResults">
                                    <tr>
                                        <td>MED001</td>
                                        <td>Paracetamol 500mg</td>
                                        <td>2.000 đ</td>
                                        <td>
                                            <button class="btn-action select-medicine" data-bs-toggle="tooltip"
                                                title="Chọn thuốc này" data-id="MED001" data-name="Paracetamol 500mg"
                                                data-price="2000">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>MED010</td>
                                        <td>Amoxicillin 500mg</td>
                                        <td>3.000 đ</td>
                                        <td>
                                            <button class="btn-action select-medicine" data-bs-toggle="tooltip"
                                                title="Chọn thuốc này" data-id="MED010" data-name="Amoxicillin 500mg"
                                                data-price="3000">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Thông tin thuốc đã chọn</label>
                        <div id="selectedMedicine" class="card bg-light p-3">
                            <div class="mb-3 d-none" id="noMedicineSelected">
                                <p class="text-muted mb-0">Chưa chọn thuốc nào</p>
                            </div>
                            <div id="medicineDetails" class="">
                                <div class="mb-2">
                                    <strong>Mã thuốc:</strong> <span id="selectedMedicineId">MED001</span>
                                </div>
                                <div class="mb-2">
                                    <strong>Tên thuốc:</strong> <span id="selectedMedicineName">Paracetamol 500mg</span>
                                </div>
                                <div class="mb-2">
                                    <strong>Đơn giá:</strong> <span id="selectedMedicinePrice">2.000 đ</span>
                                </div>
                                <div class="mb-0">
                                    <label class="form-label">Số lượng</label>
                                    <input type="number" class="form-control" id="selectedMedicineQuantity" value="1"
                                        min="1">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Huỷ</button>
                    <button type="button" class="btn btn-primary" id="addSelectedMedicineBtn">
                        <i class="fas fa-plus me-1"></i> Thêm vào hoá đơn
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Xác nhận xoá hoá đơn -->
    <div class="modal fade" id="deleteInvoiceConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-trash-alt text-danger me-2"></i> Xoá hoá đơn
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Bạn có chắc chắn muốn xoá hoá đơn này?</p>
                    <div class="alert alert-warning d-flex align-items-center border-0 bg-warning-subtle">
                        <i class="fas fa-exclamation-triangle text-warning me-2 fa-lg"></i>
                        <div>
                            <p class="mb-0">Thao tác này không thể hoàn tác và ảnh hưởng đến dữ liệu.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Huỷ bỏ</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteInvoiceBtn">
                        <i class="fas fa-trash-alt me-1"></i> Xác nhận xoá
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script src="/assets/js/invoice.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>

</html>